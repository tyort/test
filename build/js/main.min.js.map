{"version":3,"sources":["source/js/formulas.js","source/js/main.js"],"names":["renderComponent","container","element","place","prepend","after","append","createElement","template","newElement","document","innerHTML","body","querySelector","pageLink","photoGallery","movingEvents","addEventListener","evt","preventDefault","method","url","itemData","fetch","JSON","stringify","headers","Content-Type","then","response","ok","json","error","e","Error","data","sendRequest","target","value","stringOfPhotos","createPhotos","galleryImages","classList","add","turnOnListener","catch","err","console","log","dataTransfer","files","forEach","file","previewFile","children","item","photo","photoContainer","createPhotoContainer","outerHTML","firstChild","style","width","dataset","height","onPhotoClick","photos","map","index","join","className","count","parentElement","find","remove","removeEventListener","eventName","stopPropagation","reader","FileReader","readAsDataURL","onloadend","image","Image","src","result","onload","lastPhoto","lastChild","Number","droppedPhoto","createPhotoByDrop","this"],"mappings":"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","file":"main.min.js","sourcesContent":["export const renderComponent = (container, element, place) => {\n  switch (place) {\n    case `afterBegin`:\n      container.prepend(element);\n      break;\n    case `afterEnd`:\n      container.after(element);\n      break;\n    default:\n      container.append(element);\n  }\n};\n\nexport const createElement = (template) => {\n  const newElement = document.createElement(`div`);\n  newElement.innerHTML = template;\n  return newElement;\n};\n\nexport const onEscKeyDown = (evt) => {\n  if (evt.key === `Escape` || evt.key === `Esc`) {\n    hideElement();\n  }\n};\n\nexport function sendRequest(method, url, itemData = null) {\n  const headers = {\n    'Content-Type': 'application/json'\n  }\n\n  return fetch(url, {\n    method: method,\n    itemData: JSON.stringify(itemData),\n    headers: headers\n  })\n    .then(response => {\n      if (response.ok) {\n        return response.json()\n      }\n\n      return response.json()\n        .then(error => {\n          const e = new Error('Что-то пошло не так')\n          e.data = error\n          throw e\n        })\n    })\n}\n","const body = document.querySelector(`body`);\nconst pageLink = document.querySelector(`.page-link`);\nconst photoGallery = document.querySelector(`.photo-gallery`);\nconst movingEvents = [`dragenter`, `dragover`, `dragleave`, `drop`];\n\nimport {sendRequest, renderComponent, createElement} from './formulas';\n\npageLink.querySelector(`form`).addEventListener(`submit`, (evt) => {\n  evt.preventDefault();\n  const requestURL = evt.target.querySelector(`#link-address`).value\n\n  sendRequest('GET', requestURL)\n    .then(data => {\n      const stringOfPhotos = createPhotos(data.galleryImages);\n      renderComponent(photoGallery, createElement(stringOfPhotos), `afterBegin`);\n      photoGallery.querySelector(`div`).classList.add(`photo-gallery__inner`);\n      turnOnListener();\n    })\n    .catch(err => console.log(err))\n});\n\nbody.addEventListener(`drop`, (evt) => {\n  if (document.querySelector(`.photo-gallery__inner`)) {\n    const storage = evt.dataTransfer; // Объект DataTransfer используется для хранения данных, перетаскиваемых мышью во время операции drag and drop\n    const files = [...storage.files]; // список файлов с характеристиками\n    files.forEach((file) => previewFile(file));\n  }\n})\n\nconst turnOnListener = () => {\n  const photoGalleryInner = photoGallery.querySelector(`.photo-gallery__inner`);\n  const photolist = [...photoGalleryInner.children];\n\n  photolist.forEach((item) => {\n    const photo = item.querySelector(`img`);\n\n    photo.addEventListener(`click`, () => {\n      let photoContainer = createElement(createPhotoContainer(photo.outerHTML)).firstChild;\n      renderComponent(body, photoContainer, `afterBegin`);\n\n      photoContainer = document.querySelector(`.photo-container`)\n      photoContainer.querySelector(`img`).style.width = `${photo.dataset.width}px`;\n      photoContainer.querySelector(`img`).style.height = `${photo.dataset.height}px`;\n      photoContainer.addEventListener(`click`, (evt) => onPhotoClick(evt))\n    })\n  })\n}\n\nconst createPhotos = (photos) => {\n  return photos\n    .map((item, index) => {\n      return (\n        `<div class=\"placeholder\">\n          <img \n            src=\"${item.url}\"\n            data-width=\"${item.width}\"\n            data-height=\"${item.height}\"\n            data-count=\"${index}\"\n            alt=\"\">\n        </div>`\n      );\n    })\n    .join(``);\n};\n\nconst createPhotoContainer = (photo) => {\n  return (\n    `<div class=\"photo-container\">\n      ${photo}\n      <button class=\"button-wide\">Удалить фото</button>\n    </div>`\n  )\n}\n\nconst onPhotoClick = (evt) => {\n  const photoContainer = document.querySelector(`.photo-container`);\n\n  if (evt.target.className === `button-wide`) {\n    const count = evt.target.parentElement.querySelector(`img`).dataset.count;\n    const allPhotos = [...document.querySelector(`.photo-gallery__inner`).children];\n\n    const unwantedPhoto = allPhotos.find((item) => {\n      const photo = item.querySelector(`img`);\n      return photo.dataset.count === count;\n    });\n\n    unwantedPhoto.remove();\n  }\n\n  photoContainer.removeEventListener(`click`, onPhotoClick);\n  photoContainer.remove();\n}\n\n\nmovingEvents.forEach((eventName) => {\n  body.addEventListener(eventName, (evt) => {\n    evt.preventDefault()\n    evt.stopPropagation()\n  })\n})\n\nconst previewFile = (file) => {\n  const reader = new FileReader();\n  reader.readAsDataURL(file);\n\n  reader.onloadend = function() {\n    const image = new Image();\n    image.src = reader.result;\n\n    image.onload = function() {\n      const lastPhoto = document.querySelector(`.photo-gallery__inner`).lastChild.querySelector(`img`);\n      const count = Number(lastPhoto.dataset.count) + 1;\n      let droppedPhoto = createPhotoByDrop(this.width, this.height, image.src, count);\n      renderComponent(document.querySelector(`.photo-gallery__inner`), createElement(droppedPhoto).firstChild);\n\n      droppedPhoto = document.querySelector(`.photo-gallery__inner`).lastChild.querySelector(`img`);\n      droppedPhoto.addEventListener(`click`, () => {\n        let photoContainer = createElement(createPhotoContainer(droppedPhoto.outerHTML)).firstChild;\n        renderComponent(body, photoContainer, `afterBegin`);\n  \n        photoContainer = document.querySelector(`.photo-container`)\n        photoContainer.querySelector(`img`).style.width = `${droppedPhoto.dataset.width}px`;\n        photoContainer.querySelector(`img`).style.height = `${droppedPhoto.dataset.height}px`;\n        photoContainer.addEventListener(`click`, (evt) => onPhotoClick(evt))\n      })\n    };\n  }\n}\n\nconst createPhotoByDrop = (width, height, src, count) => {\n  return (\n    `<div class=\"placeholder\">\n      <img \n        src=\"${src}\"\n        data-width=\"${width}\"\n        data-height=\"${height}\"\n        data-count=\"${count}\"\n        alt=\"\">\n    </div>`\n  );\n};\n\n\n\n\n"]}